---
name: sparkcode-dev-superpower
description: 完整的软件开发工作流，集成Claude端Superpowers（设计+规划）和Codex端Superpowers（执行+审查）。当用户请求完整的开发流程或调用 /sparkcode-dev-superpower 时使用。
---

# SparkCode Dev Superpower

## 概述

这个技能协调Claude和Codex，实现端到端的开发工作流：
- **Claude负责**: 需求理解、设计、规划、分支管理
- **Codex负责**: 代码实现、测试、代码审查

## 前置条件

使用此技能前，请确保：
1. Codex端已安装Superpowers
2. 工作在共享的git仓库中
3. 已创建 `.sparkcode/logs/` 目录

## 工作流程

本技能包含5个阶段，按顺序执行。

### 阶段1: 需求理解与设计

**目标**: 通过提问理解用户需求，探讨技术方案

**执行**:

调用 @superpowers:brainstorming 技能：

```
使用 Skill 工具调用 superpowers:brainstorming
传递用户的需求描述作为参数
```

**输出**: 设计文档和需求澄清

**下一步**: 用户确认设计后，进入阶段2

### 阶段2: 编写实现计划

**目标**: 基于设计生成详细的实现计划

**执行**:

调用 @superpowers:writing-plans 技能：

```
使用 Skill 工具调用 superpowers:writing-plans
传递设计文档内容作为参数
```

**输出**: `docs/plans/YYYY-MM-DD-<topic>-plan.md`

**验证**:
- 计划文件已创建
- 包含任务分解（3-8个任务）
- 每个任务预估时间2-5分钟

**下一步**: 用户确认计划后，进入阶段3

### 阶段3: 代码实现（Codex执行）

**目标**: 调用Codex执行计划中的所有任务

**步骤3.1: 提取计划名称**

从计划文件路径提取名称：

```bash
# 输入: docs/plans/2026-01-19-feature-x-plan.md
# 输出: 2026-01-19-feature-x-plan

plan_file="docs/plans/2026-01-19-feature-x-plan.md"
plan_name=$(basename "$plan_file" .md)
echo "计划名称: $plan_name"
```

**步骤3.2: 创建状态文件**

```bash
mkdir -p .sparkcode/logs
cat > .sparkcode/session-state.json <<EOF
{
  "session_id": "$(uuidgen)",
  "current_stage": "executing",
  "plan_file": "$plan_file",
  "plan_name": "$plan_name",
  "codex_execution": {
    "started_at": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
    "status": "running"
  }
}
EOF
```

**步骤3.3: 调用Codex执行**

使用 Bash 工具执行：

```bash
codex exec --full-auto \
  --prompt "Run ~/.codex/superpowers/.codex/superpowers-codex \
  use-skill superpowers:executing-plans $plan_name"
```

**步骤3.4: 解析执行结果**

检查Codex的输出：

```bash
# 检查退出码
if [ $? -eq 0 ]; then
  echo "✓ Codex执行成功"
else
  echo "✗ Codex执行失败，退出码: $?"
fi
```

**成功标识**:
- 退出码 = 0
- 输出包含 "✓" 或 "Success" 或 "completed"

**失败标识**:
- 退出码 ≠ 0
- 输出包含 "✗" 或 "Error" 或 "failed"

**步骤3.5: 向用户展示结果**

提取并展示关键信息：
- 完成的任务数
- 通过的测试数
- 新增/修改的文件

**错误处理**:

如果执行失败：
1. 展示错误信息
2. 询问用户：
   - a) 重试执行
   - b) 修改计划后重试
   - c) 手动介入调试
   - d) 放弃当前任务

**输出**: 实现的代码 + 测试结果

**下一步**: 执行成功后，进入阶段4

### 阶段4: 代码审查（Codex审查）

**目标**: 调用Codex审查未提交的代码变更

**步骤4.1: 调用Codex审查**

使用 Bash 工具执行：

```bash
codex exec --full-auto \
  --prompt "Run ~/.codex/superpowers/.codex/superpowers-codex \
  use-skill superpowers:requesting-code-review"
```

**步骤4.2: 解析审查报告**

从Codex输出中提取：
- **Critical**: 严重问题（安全漏洞、逻辑错误）
- **Major**: 重要问题（性能问题、代码质量）
- **Minor**: 次要问题（代码风格、命名）
- **Suggestions**: 改进建议

**步骤4.3: 向用户展示结果**

```
审查结果:
  ✗ Critical: X
  ⚠ Major: Y
  ℹ Minor: Z
  💡 Suggestions: W

选项:
  ✓ 通过，进入分支完成阶段
  🔧 修复问题后重新审查
  👀 查看详细报告
```

**决策逻辑**:
- 如果有Critical问题: 强烈建议修复后再继续
- 如果只有Major/Minor问题: 可以选择继续或修复
- 如果无问题: 自动进入下一阶段

**输出**: 审查报告

**下一步**: 用户确认后，进入阶段5

### 阶段5: 分支完成

**目标**: 完成开发工作，决定如何集成代码

**执行**:

调用 @superpowers:finishing-a-development-branch 技能：

```
使用 Skill 工具调用 superpowers:finishing-a-development-branch
```

**流程**:
1. 运行最终测试验证
2. 展示变更摘要
3. 提供选项:
   - Merge到主分支
   - 创建Pull Request
   - 清理分支

**输出**: 完成的功能分支

**完成**: 工作流结束
